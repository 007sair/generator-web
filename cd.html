<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection"content="telephone=no, email=no" />
<title>Examples</title>
<link rel="stylesheet" href="">
</head>
<body>

<div id="time">
	<span id="y">xx</span>年 
	<span id="d">xx</span>天 
	<span id="h">xx</span>时 
	<span id="m">xx</span>分 
	<span id="s">xx</span>秒
	<span id="ms">xx</span>秒
</div>

<div id="log"></div>


<script src="http://cdn.bootcss.com/zepto/1.1.2/zepto.min.js"></script>
<script type="text/javascript">
;(function(){

	
	function getID(id) {
		return document.getElementById(id)
	}

	function countDown(objTime, callback) {
		console.log(objTime)
		var timer = null;
		var startTime = +new Date(objTime.start);
		var endTime = +new Date(objTime.end);

		var lastTime = 0,
			offset = 0,
			localDiff = 0;
		
		function render(data) {
			getID('y').innerHTML = data.years;
			getID('d').innerHTML = data.days;
			getID('h').innerHTML = data.hours;
			getID('m').innerHTML = data.min;
			getID('s').innerHTML = data.sec;
		}
		
		function getDiffDate() {
			lastTime = localDiff;
			localDiff = Math.floor((endTime - +new Date()) / 1000);
			offset = (lastTime !== 0) ? lastTime - localDiff : 1; //偏移值为1才正常
			startTime = startTime + (1000 * offset);
			var diff = Math.floor((endTime - startTime) / 1000);

			getID('log').innerHTML = diff + '****' + localDiff + '****' + offset;

			var dateData = {
				years: 0,
				days: 0,
				hours: 0,
				min: 0,
				sec: 0,
				millisec: 0
			};

			if (diff <= 0) {
				clearTimeout(timer);
				callback && callback();
			}

			if (diff >= (365.25 * 86400)) {
				dateData.years = Math.floor(diff / (365.25 * 86400));
				diff -= dateData.years * 365.25 * 86400;
			}

			if (diff >= 86400) {
				dateData.days = Math.floor(diff / 86400);
				diff -= dateData.days * 86400;
			}

			if (diff >= 3600) {
				dateData.hours = Math.floor(diff / 3600);
				diff -= dateData.hours * 3600;
			}

			if (diff >= 60) {
				dateData.min = Math.floor(diff / 60);
				diff -= dateData.min * 60;
			}
			dateData.sec = Math.round(diff);
			dateData.millisec = diff % 1 * 1000;

			return dateData;
		}

		clock();
		function clock() {
			render(getDiffDate());
		}
		timer = setInterval(clock, 1000);
	}

	countDown({
		start: '2017/1/20 11:49:50',
		end: '2017/1/20 11:50:00'
	}, function() {
		console.log('done')
	});

})();

</script>

    
</body>
</html>
